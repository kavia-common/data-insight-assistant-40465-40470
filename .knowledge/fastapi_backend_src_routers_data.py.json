{"is_source_file": true, "format": "Python", "description": "This file defines FastAPI route handlers for managing a collection of data items stored in MongoDB. It includes endpoints for listing, retrieving, creating, updating, and deleting data items, with support for filtering, pagination, and sorting.", "external_files": ["../db/mongo", "../models/schemas"], "external_methods": ["get_collection", "serialize_object_id", "PyObjectId.validate"], "published": ["list_data", "get_data_item", "create_data_item", "update_data_item", "delete_data_item"], "classes": [], "methods": [{"name": "_get_coll_or_503()", "description": "Internal helper to retrieve the MongoDB collection object or raise a 503 HTTPException if unavailable.", "scope": "", "scopeKind": ""}, {"name": "Optional[Dict[str,int]] _build_projection(fields: Optional[List[str]])", "description": "Constructs a MongoDB projection dictionary from a list of fields, always including '_id' unless explicitly excluded.", "scope": "", "scopeKind": ""}, {"name": "Optional[List[Tuple[str,int]]] _build_sort(sort_by: Optional[str], sort_dir: Optional[str])", "description": "Creates a MongoDB sort specification based on a sort field and direction.", "scope": "", "scopeKind": ""}, {"name": "Dict[str,Any] _normalize_filter(raw_filter: Optional[Dict[str, Any]])", "description": "Normalizes filter criteria, converting string IDs to ObjectId where appropriate.", "scope": "", "scopeKind": ""}, {"name": "DataItemsPage list_data( filter: Optional[str] = Query( default=None, description=\"JSON string for MongoDB-like filter. Example: {\"data.country\": \"US\"}\", ), fields: Optional[str] = Query( default=None, description=\"Comma-separated fields to include in the response. Example: data.name,data.age\", ), sort_by: Optional[str] = Query(default=None, description=\"Field to sort by.\"), sort_dir: Optional[str] = Query(default=\"asc\", pattern=\"^(asc|desc)$\", description=\"Sort direction.\"), limit: int = Query(default=50, ge=1, le=1000, description=\"Max items to return.\"), offset: int = Query(default=0, ge=0, description=\"Number of items to skip.\"), )", "description": "Endpoint for retrieving a paginated list of data items with optional filtering, projection, and sorting.", "scope": "", "scopeKind": ""}, {"name": "DataItemOut get_data_item(item_id: str)", "description": "Endpoint to retrieve a single data item by its ObjectId.", "scope": "", "scopeKind": ""}, {"name": "DataItemOut create_data_item(payload: DataItemIn)", "description": "Endpoint to create a new data item, storing the payload's data under a 'data' field.", "scope": "", "scopeKind": ""}, {"name": "DataItemOut update_data_item(item_id: str, payload: DataItemIn)", "description": "Endpoint to update the 'data' field of an existing data item by its ObjectId.", "scope": "", "scopeKind": ""}, {"name": "None delete_data_item(item_id: str)", "description": "Endpoint to delete a data item by its ObjectId.", "scope": "", "scopeKind": ""}], "calls": ["get_collection", "serialize_object_id", "PyObjectId.validate", "coll.count_documents", "coll.find", "coll.find_one", "coll.insert_one", "coll.find_one_and_update", "coll.delete_one"], "search-terms": ["FastAPI data endpoints", "MongoDB data collection", "DataItemIn", "DataItemOut", "pagination", "filtering MongoDB", "sorting MongoDB", "ObjectId handling", "FastAPI APIRouter", "MongoDB projection"], "state": 2, "file_id": 15, "knowledge_revision": 89, "git_revision": "525a4ee3142b3f0e14bd32ed9d48e3f89e0b6a08", "revision_history": [{"35": "de8dac7f2dbfa13add05824461f11be20f7998ad"}, {"45": "3c81c8aeb8f50ad795128e86af25f55d4b647315"}, {"46": "3c81c8aeb8f50ad795128e86af25f55d4b647315"}, {"89": "525a4ee3142b3f0e14bd32ed9d48e3f89e0b6a08"}], "ctags": [{"_type": "tag", "name": "_build_projection", "path": "/home/kavia/workspace/code-generation/data-insight-assistant-40465-40470/fastapi_backend/src/routers/data.py", "pattern": "/^def _build_projection(fields: Optional[List[str]]) -> Optional[Dict[str, int]]:$/", "language": "Python", "typeref": "typename:Optional[Dict[str,int]]", "kind": "function", "signature": "(fields: Optional[List[str]])"}, {"_type": "tag", "name": "_build_sort", "path": "/home/kavia/workspace/code-generation/data-insight-assistant-40465-40470/fastapi_backend/src/routers/data.py", "pattern": "/^def _build_sort(sort_by: Optional[str], sort_dir: Optional[str]) -> Optional[List[Tuple[str, int/", "language": "Python", "typeref": "typename:Optional[List[Tuple[str,int]]]", "kind": "function", "signature": "(sort_by: Optional[str], sort_dir: Optional[str])"}, {"_type": "tag", "name": "_get_coll_or_503", "path": "/home/kavia/workspace/code-generation/data-insight-assistant-40465-40470/fastapi_backend/src/routers/data.py", "pattern": "/^def _get_coll_or_503():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_normalize_filter", "path": "/home/kavia/workspace/code-generation/data-insight-assistant-40465-40470/fastapi_backend/src/routers/data.py", "pattern": "/^def _normalize_filter(raw_filter: Optional[Dict[str, Any]]) -> Dict[str, Any]:$/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "function", "signature": "(raw_filter: Optional[Dict[str, Any]])"}, {"_type": "tag", "name": "create_data_item", "path": "/home/kavia/workspace/code-generation/data-insight-assistant-40465-40470/fastapi_backend/src/routers/data.py", "pattern": "/^async def create_data_item(payload: DataItemIn) -> DataItemOut:$/", "language": "Python", "typeref": "typename:DataItemOut", "kind": "function", "signature": "(payload: DataItemIn)"}, {"_type": "tag", "name": "delete_data_item", "path": "/home/kavia/workspace/code-generation/data-insight-assistant-40465-40470/fastapi_backend/src/routers/data.py", "pattern": "/^async def delete_data_item(item_id: str) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(item_id: str)"}, {"_type": "tag", "name": "get_data_item", "path": "/home/kavia/workspace/code-generation/data-insight-assistant-40465-40470/fastapi_backend/src/routers/data.py", "pattern": "/^async def get_data_item(item_id: str) -> DataItemOut:$/", "language": "Python", "typeref": "typename:DataItemOut", "kind": "function", "signature": "(item_id: str)"}, {"_type": "tag", "name": "list_data", "path": "/home/kavia/workspace/code-generation/data-insight-assistant-40465-40470/fastapi_backend/src/routers/data.py", "pattern": "/^async def list_data($/", "language": "Python", "typeref": "typename:DataItemsPage", "kind": "function", "signature": "( filter: Optional[str] = Query( default=None, description=\"JSON string for MongoDB-like filter. Example: {\"data.country\": \"US\"}\", ), fields: Optional[str] = Query( default=None, description=\"Comma-separated fields to include in the response. Example: data.name,data.age\", ), sort_by: Optional[str] = Query(default=None, description=\"Field to sort by.\"), sort_dir: Optional[str] = Query(default=\"asc\", pattern=\"^(asc|desc)$\", description=\"Sort direction.\"), limit: int = Query(default=50, ge=1, le=1000, description=\"Max items to return.\"), offset: int = Query(default=0, ge=0, description=\"Number of items to skip.\"), )"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/data-insight-assistant-40465-40470/fastapi_backend/src/routers/data.py", "pattern": "/^router = APIRouter(prefix=\"\\/data\", tags=[\"Data\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "update_data_item", "path": "/home/kavia/workspace/code-generation/data-insight-assistant-40465-40470/fastapi_backend/src/routers/data.py", "pattern": "/^async def update_data_item(item_id: str, payload: DataItemIn) -> DataItemOut:$/", "language": "Python", "typeref": "typename:DataItemOut", "kind": "function", "signature": "(item_id: str, payload: DataItemIn)"}], "hash": "375fdb630339e8c3dbf243d3bb7e6198", "format-version": 4, "code-base-name": "fastapi_backend", "filename": "fastapi_backend/src/routers/data.py", "fields": [{"name": "router = APIRouter(prefix=\"\\/data\", tags=[\"Data\"])", "scope": "", "scopeKind": "", "description": "unavailable"}]}