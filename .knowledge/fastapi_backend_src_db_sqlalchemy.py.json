{"is_source_file": true, "format": "Python", "description": "This file initializes and manages the SQLAlchemy database connection for a FastAPI project. It defines lazy-initialized engine and sessionmaker objects, resolves the database URL from environment variables, and provides utility functions for other modules to access the database engine and sessions. It also sets up the declarative base for ORM models.", "external_files": ["../core/config", "../core/logger"], "external_methods": ["get_settings", "get_logger"], "published": ["Base", "get_engine", "get_sessionmaker", "get_db"], "classes": [], "methods": [{"name": "str _get_db_url()", "description": "Resolves the database URL from environment variables, prioritizing DATABASE_URL over deprecated SUPABASE_DB_CONNECTION_STRING, and raises an error if neither is set.", "scope": "", "scopeKind": ""}, {"name": "None _ensure_engine_initialized()", "description": "Initializes the SQLAlchemy engine and sessionmaker if they are not already initialized, using the database URL obtained from configuration.", "scope": "", "scopeKind": ""}, {"name": "Engine get_engine()", "description": "Returns the lazily-initialized SQLAlchemy Engine instance.", "scope": "", "scopeKind": ""}, {"name": "sessionmaker get_sessionmaker()", "description": "Returns the lazily-initialized SQLAlchemy sessionmaker object.", "scope": "", "scopeKind": ""}, {"name": "Generator[Session,None,None] get_db()", "description": "Provides a database session to the caller, ensuring it is closed after use.", "scope": "", "scopeKind": ""}], "calls": ["get_settings", "get_logger", "_get_db_url", "_ensure_engine_initialized", "create_engine", "sessionmaker", "logger.info", "logger.error"], "search-terms": ["SQLAlchemy engine", "lazy initialization", "Postgres connection", "FastAPI dependency", "environment variable database URL", "declarative base", "session factory"], "state": 2, "file_id": 24, "knowledge_revision": 132, "git_revision": "50400fc0d5416538c80ce5b0ec58ff4323335ca3", "revision_history": [{"94": ""}, {"104": ""}, {"105": ""}, {"110": ""}, {"112": ""}, {"118": "822197812f72cca059d4c53b49ce954445db8e09"}, {"125": "b4bd1ec8ce9dc6dfa5f4405cd37bcad0304f02b7"}, {"132": "50400fc0d5416538c80ce5b0ec58ff4323335ca3"}], "ctags": [{"_type": "tag", "name": "Base", "path": "/home/kavia/workspace/code-generation/data-insight-assistant-40465-40470/fastapi_backend/src/db/sqlalchemy.py", "pattern": "/^Base = declarative_base()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_SessionLocal", "path": "/home/kavia/workspace/code-generation/data-insight-assistant-40465-40470/fastapi_backend/src/db/sqlalchemy.py", "pattern": "/^_SessionLocal: Optional[sessionmaker] = None$/", "language": "Python", "typeref": "typename:Optional[sessionmaker]", "kind": "variable"}, {"_type": "tag", "name": "_engine", "path": "/home/kavia/workspace/code-generation/data-insight-assistant-40465-40470/fastapi_backend/src/db/sqlalchemy.py", "pattern": "/^_engine: Optional[Engine] = None$/", "language": "Python", "typeref": "typename:Optional[Engine]", "kind": "variable"}, {"_type": "tag", "name": "_ensure_engine_initialized", "path": "/home/kavia/workspace/code-generation/data-insight-assistant-40465-40470/fastapi_backend/src/db/sqlalchemy.py", "pattern": "/^def _ensure_engine_initialized() -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_get_db_url", "path": "/home/kavia/workspace/code-generation/data-insight-assistant-40465-40470/fastapi_backend/src/db/sqlalchemy.py", "pattern": "/^def _get_db_url() -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "get_db", "path": "/home/kavia/workspace/code-generation/data-insight-assistant-40465-40470/fastapi_backend/src/db/sqlalchemy.py", "pattern": "/^def get_db() -> Generator[Session, None, None]:$/", "language": "Python", "typeref": "typename:Generator[Session,None,None]", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "get_engine", "path": "/home/kavia/workspace/code-generation/data-insight-assistant-40465-40470/fastapi_backend/src/db/sqlalchemy.py", "pattern": "/^def get_engine() -> Engine:$/", "language": "Python", "typeref": "typename:Engine", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "get_sessionmaker", "path": "/home/kavia/workspace/code-generation/data-insight-assistant-40465-40470/fastapi_backend/src/db/sqlalchemy.py", "pattern": "/^def get_sessionmaker() -> sessionmaker:$/", "language": "Python", "typeref": "typename:sessionmaker", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "logger", "path": "/home/kavia/workspace/code-generation/data-insight-assistant-40465-40470/fastapi_backend/src/db/sqlalchemy.py", "pattern": "/^logger = get_logger(__name__)$/", "language": "Python", "kind": "variable"}], "hash": "7215ea25aebd9fe60c1a54d92144bbc8", "format-version": 4, "code-base-name": "fastapi_backend", "filename": "fastapi_backend/src/db/sqlalchemy.py", "fields": [{"name": "Base = declarative_base()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Optional[sessionmaker] _SessionLocal", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Optional[Engine] _engine", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "logger = get_logger(__name__)", "scope": "", "scopeKind": "", "description": "unavailable"}]}