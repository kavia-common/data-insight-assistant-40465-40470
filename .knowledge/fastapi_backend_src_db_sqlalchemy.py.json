{"is_source_file": true, "format": "Python", "description": "This file initializes and manages SQLAlchemy database connections for a FastAPI application, including lazy engine creation, URL construction from environment variables, and providing database sessions for request handling.", "external_files": ["../core/config", "../core/logger", "sqlalchemy", "sqlalchemy.engine", "sqlalchemy.orm", "sqlalchemy.pool"], "external_methods": ["get_settings", "get_logger", "create_engine", "declarative_base", "sessionmaker"], "published": ["Base", "get_engine", "get_sessionmaker", "get_db"], "classes": [], "methods": [{"name": "_build_url_from_discrete_env", "description": "Constructs a Postgres SQLAlchemy URL from environment variables if all required variables are present."}, {"name": "_append_sslmode_require", "description": "Ensures the connection URL includes 'sslmode=require' parameter."}, {"name": "_ensure_psycopg2_scheme", "description": "Ensures the URL explicitly uses the psycopg2 driver."}, {"name": "_get_db_url", "description": "Resolves the database URL from environment variables or configuration, with priority order."}, {"name": "_effective_db_params", "description": "Parses the database URL to extract and redact sensitive info for logging."}, {"name": "get_effective_db_params", "description": "Public function to get redacted database connection parameters for diagnostics."}, {"name": "_ensure_engine_initialized", "description": "Initializes the SQLAlchemy engine and session factory if not already done, with lazy loading."}, {"name": "get_engine", "description": "Returns the lazily-initialized SQLAlchemy Engine instance."}, {"name": "get_sessionmaker", "description": "Returns the lazily-initialized SQLAlchemy sessionmaker."}, {"name": "get_db", "description": "Provides a database session generator for request handling, ensuring cleanup."}], "calls": ["get_settings", "get_logger", "create_engine", "declarative_base", "sessionmaker", "_get_db_url", "_effective_db_params", "get_engine", "get_sessionmaker"], "search-terms": ["SQLAlchemy", "Postgres", "database initialization", "lazy engine", "FastAPI dependency", "environment variables", "connection URL", "session management"], "state": 2, "file_id": 24, "knowledge_revision": 178, "git_revision": "65890990f51cd61721ace930f68141bc34d972b9", "revision_history": [{"94": ""}, {"104": ""}, {"105": ""}, {"110": ""}, {"112": ""}, {"118": "822197812f72cca059d4c53b49ce954445db8e09"}, {"125": "b4bd1ec8ce9dc6dfa5f4405cd37bcad0304f02b7"}, {"132": "50400fc0d5416538c80ce5b0ec58ff4323335ca3"}, {"137": "0bc30f0d68e1d20e720a275bd477e640dba2e54c"}, {"141": "e067de21ffef257c6850ad602fa3464ee5e7630e"}, {"148": "5442c3324a2d02c040e580bcee8b1897d6c2f973"}, {"149": "5442c3324a2d02c040e580bcee8b1897d6c2f973"}, {"151": "65890990f51cd61721ace930f68141bc34d972b9"}, {"152": "65890990f51cd61721ace930f68141bc34d972b9"}, {"178": "65890990f51cd61721ace930f68141bc34d972b9"}], "ctags": [], "filename": "fastapi_backend/src/db/sqlalchemy.py", "format-version": 4, "code-base-name": "https://github.com/kavia-common/data-insight-assistant-40465-40470.git:kavia-main"}